!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.Phenomenon=r()}(this,function(){var e=function(e){function r(r,t,a){e.call(this);for(var n=r.faces,o=r.vertices,i=o.length,f=3*n.length,h=[],d=0;d<n.length;d+=1)h.push(n[d].a,n[d].b,n[d].c);for(var s=new Uint32Array(t*f),u=0;u<t;u+=1)for(var c=0;c<f;c+=1)s[u*f+c]=h[c]+u*i;this.setIndex(new THREE.BufferAttribute(s,1));for(var m=new Float32Array(t*i*3),v=0,l=0;l<t;l+=1)for(var p=0;p<i;p+=1,v+=3){var E=o[p];m[v]=E.x,m[v+1]=E.y,m[v+2]=E.z}var S=new THREE.BufferAttribute(m,3);this.addAttribute("position",S);for(var g=0;g<a.length;g+=1){var x=new Float32Array(t*i*a[g].size),b=new THREE.BufferAttribute(x,a[g].size);this.addAttribute(a[g].name,b);for(var w=0;w<t;w+=1){var y=a[g].data(w,t);v=w*i*b.itemSize;for(var A=0;A<i;A+=1)for(var H=0;H<b.itemSize;H+=1)x[v]=y[H],v+=1}}return this}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r}(THREE.BufferGeometry),r=function(r,t,a,n,o,i,f,h){var d=new e(r,a,n),s=new THREE.Mesh(d,t);return s.geometry.computeVertexNormals(),t.onBeforeCompile=function(e){s.shader=e,Object.assign(e.uniforms,o);var r=i.replace(/(\r\n|\n|\r)/gm,""),a=r.match(/.+?(?=void)/)[0],n=r.match(/main\(\){(.*?)}/)[1];e.vertexShader=a+" \n "+e.vertexShader,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>",n.replace("gl_Position =","vec3 transformed ="));for(var d=0;d<h.length;d+=1)e.fragmentShader=e.fragmentShader.replace(h[d][0],h[d][1]);if(t.onBeforeCompile=t.onBeforeCompile.toString().slice(0,-1)+"/* "+Math.random()+" */}",f){var u=new THREE.ShaderMaterial({vertexShader:e.vertexShader,fragmentShader:THREE.ShaderLib.shadow.fragmentShader,uniforms:o});s.castShadow=!0,s.customDepthMaterial=u,s.customDistanceMaterial=u}},{mesh:s,uniforms:o}};return THREE.Phenomenon=r,r});
